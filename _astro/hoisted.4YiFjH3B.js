import{p as A}from"./PhaserGame.astro_astro_type_script_index_0_lang.BEm-lufV.js";import{d as N}from"./scene-with-phaser-wind.DlXQxYJt.js";import{a as E,H as R}from"./plugin.gUYo12OL.js";import{T as C}from"./text-button.DVKaft8x.js";import"./icon-text.Cik5XBWK.js";import{S as D}from"./scene-with-hudini.DwPz9Phj.js";import"./hoisted.B7maJBHf.js";const v=10;class K{constructor(e){this.plugin=e,this.plugin=e}get game(){return this.plugin.getGame()}loadBySoundKey(e,t){const{game:n,plugin:a}=this;n.cache.audio.has(t)||e.load.audio(t,a.soundList[t]?.path)}loadByChannel(e,t){const{plugin:n}=this;Object.entries(n.soundList).filter(a=>a[1].channel===t).forEach(([a])=>{this.loadBySoundKey(e,a)})}}class x{constructor(e){this.plugin=e,this.plugin=e}get game(){return this.plugin.getGame()}get soundRegistry(){return this.plugin.soundRegistry}play(e){const t=this.soundRegistry.getChannelBySoundKey(e);switch(t.mode){case"single":this.playSingleMode(e);break;case"multiple":this.playMultipleMode(e,t.maxInstances);break}}playSingleMode(e){const t=this.soundRegistry.getSoundBySoundKey(e);if(t){t.isPlaying||t.play();return}const n=this.soundRegistry.getSoundConfigBySoundKey(e);this.game.sound.add(e,{volume:n?.channel?this.plugin.getChannelVolume(n.channel):1,loop:n?.loop??!1}).play()}playMultipleMode(e,t=v){const n=this.soundRegistry.fetchSoundsBySoundKey(e),a=n.find(s=>!s.isPlaying);if(a){a.play();return}if(n.length<t){const s=this.soundRegistry.getSoundConfigBySoundKey(e);this.game.sound.add(e,{volume:s?.channel?this.plugin.getChannelVolume(s.channel):1,loop:s?.loop??!1}).play()}}}class P{constructor(e){this.plugin=e,this.plugin=e}get game(){return this.plugin.getGame()}get soundPlayer(){return this.plugin.soundPlayer}get channels(){return this.plugin.channels}get soundList(){return this.plugin.soundList}getSoundConfigBySoundKey(e){return this.soundList[e]??null}getSoundBySoundKey(e){const t=this.fetchSoundsBySoundKey(e);return t.length>0?t[0]:null}fetchSoundsBySoundKey(e){return this.game.sound.getAll(e)}getChannelBySoundKey(e){const t=this.soundList[e];return this.channels[t.channel]}}const u=()=>new Date().toISOString().replace("T"," ").replace("Z",""),h=o=>{const e=u(),t="%c[phaser-hooks]%c",n=o?` %c${o}%c`:"";return`%c[${e}]%c ${t}${n}`},d=o=>{const e=["color: #bd93f9; font-weight: bold;","color: inherit;","color: #2563eb; font-weight: bold;","color: inherit;"];return o&&e.push("color: #059669; font-weight: bold;","color: inherit;"),e},I=(o,e)=>{const t=h("STATE_INIT"),n=d("STATE_INIT");console.groupCollapsed(`${t} Initializing state "${o}"`,...n),console.log("ðŸ”§ Key:",o),console.log("ðŸ“¦ Initial Value:",e),console.log("â° Timestamp:",u()),console.groupEnd()},B=(o,e)=>{const t=h("STATE_GET"),n=d("STATE_GET");console.log(`${t} Getting state "${o}":`,...n,e)},w=(o,e,t)=>{const n=h("STATE_SET"),a=d("STATE_SET");console.groupCollapsed(`${n} Updating state "${o}"`,...a),console.log("ðŸ”‘ Key:",o),console.log("ðŸ“¤ Old Value:",e),console.log("ðŸ“¥ New Value:",t),console.log("ðŸ”„ Changed:",e!==t),console.log("â° Timestamp:",u()),console.groupEnd()},L=(o,e,t)=>{const n=h("EVENT_ADD"),a=d("EVENT_ADD");console.groupCollapsed(`${n} Adding listener for "${o}"`,...a),console.log("ðŸ”‘ Key:",o),console.log("ðŸ“¡ Event:",e),console.log("ðŸŽ¯ Callback:",t.name||"anonymous"),console.log("â° Timestamp:",u()),console.groupEnd()},y=(o,e,t)=>{const n=h("EVENT_REMOVE"),a=d("EVENT_REMOVE");console.groupCollapsed(`${n} Removing listener for "${o}"`,...a),console.log("ðŸ”‘ Key:",o),console.log("ðŸ“¡ Event:",e),console.log("ðŸŽ¯ Callback:",t.name||"anonymous"),console.log("â° Timestamp:",u()),console.groupEnd()},M=o=>{const e=h("CLEAR_LISTENERS"),t=d("CLEAR_LISTENERS");console.groupCollapsed(`${e} Clearing all listeners for "${o}"`,...t),console.log("ðŸ”‘ Key:",o),console.log("ðŸ§¹ Action:","Removing all event listeners"),console.log("â° Timestamp:",u()),console.groupEnd()},H=(o,e,t)=>{const n=h(o),a=d(o);console.groupCollapsed(`${n} ERROR`,...a),console.error("ðŸš¨ Operation:",o),console.error("ðŸ’¥ Error:",e),t&&console.error("ðŸ“‹ Context:",t),console.error("â° Timestamp:",u()),console.groupEnd()},b=(o,e,t)=>{const n=h(o),a=d(o);console.groupCollapsed(`${n} WARNING`,...a),console.warn("âš ï¸ Operation:",o),console.warn("ðŸ“¢ Message:",e),t&&console.warn("ðŸ“‹ Context:",t),console.warn("â° Timestamp:",u()),console.groupEnd()},p=o=>o!==null&&typeof o=="object"&&!Array.isArray(o)&&Object.prototype.toString.call(o)==="[object Object]",m=o=>{if(o===null||typeof o!="object")return o;if(Array.isArray(o))return o.map(e=>m(e));if(p(o)){const e={};for(const t in o)Object.prototype.hasOwnProperty.call(o,t)&&(e[t]=m(o[t]));return e}return o},$=(o,...e)=>{if(!p(o))return o;let t=m(o);for(const n of e){if(!p(n))continue;const a=m(n);for(const s in a)if(Object.prototype.hasOwnProperty.call(a,s)){const l=a[s],i=t[s];p(l)&&p(i)?t[s]=$(i,l):l!==void 0&&(t[s]=l)}}return t},U="0.6.1",V=(o,e)=>{if(typeof window<"u"){const t=window,n=t.__PHASER_HOOKS_CTX__||=[];n.push({lib:"phaser-hooks",version:U,...o});try{e()}finally{n.pop()}}else e()},f=new WeakMap,G=(o,e,t)=>{const n=o.get(e);return t&&B(e,n),n},z=(o,e,t,n,a,s)=>{const l=o.get(e),i=typeof t=="function"?t(l):t;if(s){const r=s(i);if(r!==!0){const c=typeof r=="string"?r:`Invalid value for key "${e}"`;throw new Error(`[withStateDef] ${c}`)}}V({op:"set",oldValue:l,store:e,registryType:a},()=>{o.set(e,i)}),n&&w(e,l,i)},j=(o,e,t,n,a,s)=>{const l=o.get(e);if(typeof l!="object"||l===null)throw new Error("[withStateDef] Current value is not an object");const i=typeof t=="function"?t(l):t,r=$({},l,i);if(s){const c=s(r);if(c!==!0){const g=typeof c=="string"?c:`Invalid value for key "${e}"`;throw new Error(`[withStateDef] ${g}`)}}V({op:"patch",oldValue:l,store:e,registryType:a},()=>{o.set(e,r)}),n&&w(e,l,r)},F=(o,e,t,n)=>{if(b("DEPRECATED_ONCHANGE","onChange callback is deprecated in phaser-hooks. Use .on('change', callback) or .once('change', callback) instead.",{key:e}),!n||typeof n!="function")throw new Error("[withStateDef] onChange callback must be a function");o.events.on(`changedata-${e}`,(a,s,l,i)=>{t&&w(s,i,l);try{n(l,i)}catch(r){H("ONCHANGE_CALLBACK_ERROR",r,{key:s})}})},W=(o,e,t,n,a)=>{if(e!=="change")throw new Error('[withStateDef] Invalid event. Only "change" is supported.');const s=(l,i,r)=>{a(i,r)};return f.has(a)||f.set(a,s),n&&L(t,e,s),o.events.on(`changedata-${t}`,s),()=>{n&&y(t,e,s),o.events.off(`changedata-${t}`,s)}},X=(o,e,t)=>{if(!o)throw new Error("[withStateDef] Scene parameter is required");if(!t||typeof t!="string"||t.trim().length===0)throw new Error("[withStateDef] Key must be a non-empty string");if(e.global&&!o.registry)throw new Error("[withStateDef] Scene registry is not available. Ensure the scene is properly initialized.");if(!e.global&&!o.data)throw new Error("[withStateDef] Scene data is not available. Ensure the scene is properly initialized.")},Y=(o,e,t,n,a)=>{if(!o.has(e)&&a!==void 0){if(n){const s=n(a);if(s!==!0){const l=typeof s=="string"?s:`Invalid initial value for key "${e}"`;throw new Error(`[withStateDef] ${l}`)}}o.set(e,a),t&&I(e,a)}},q=(o,e,t,n,a)=>{if(e!=="change")throw new Error('[withStateDef] Invalid event. Only "change" is supported.');const s=(l,i,r)=>{a(i,r)};return f.has(a)||f.set(a,s),n&&L(t,e,s),o.events.once(`changedata-${t}`,s),()=>{n&&y(t,e,s),o.events.off(`changedata-${t}`,s)}},J=(o,e,t,n,a)=>{if(e!=="change")throw new Error('[withStateDef] Invalid event. Only "change" is supported.');const s=f.get(a);if(!s){b("CALLBACK_NOT_FOUND",`Callback not found for key "${t}"`,{key:t});return}o.events.off(`changedata-${t}`,s),n&&y(t,e,s)},Z=(o,e,t)=>{o.events.removeAllListeners(`changedata-${e}`),t&&M(e)},Q=(o,e,t,n={})=>{X(o,n,e);const{validator:a,debug:s=!1,global:l=!1}=n,i=l?o.registry:o.data,r=l?"global":"local";return Y(i,e,s,a,t),{get:()=>G(i,e,s),set:c=>z(i,e,c,s,r,a),patch:c=>j(i,e,c,s,r,a),onChange:c=>F(i,e,s,c),on:(c,g)=>W(i,c,e,s,g),once:(c,g)=>q(i,c,e,s,g),off:(c,g)=>J(i,c,e,s,g),clearListeners:()=>Z(i,e,s)}},k=(o,e,t,n)=>{if(!o)throw new Error("[withGlobalState] Scene parameter is required");const a=`phaser-hooks:global:${e}`;return Q(o,a,t,{...n,global:!0})},O=(o,e,t,n,a="local")=>{const s=`phaser-hooks-state:${e}`;let l=t;try{const r=a==="local"?localStorage.getItem(s):sessionStorage.getItem(s);r&&(l=JSON.parse(r))}catch(r){console.warn(`[withPersistentState] Failed to load stored state for "${e}":`,r)}const i=k(o,e,l);return i.onChange(r=>{try{(a==="local"?localStorage:sessionStorage).setItem(s,JSON.stringify(r))}catch(c){console.warn(`[withPersistentState] Failed to save state for "${e}":`,c)}}),i},S="soundStudio";class ee extends A.Plugins.BasePlugin{channelVolumes={};soundPlayer;soundLoader;soundRegistry;soundList;channels;storage;gameName;getGame(){return this.game}constructor(e){super(e),this.soundList={},this.soundLoader=new K(this),this.channels={},this.storage="local",this.soundPlayer=new x(this),this.soundRegistry=new P(this)}init({soundList:e,channels:t,storage:n,gameName:a}){this.soundList=e,this.channels=t,this.storage=n,this.gameName=a,Object.keys(t).forEach(s=>{this.channelVolumes[s]=1})}loadAll(e){const t=Object.entries(this.soundList).filter(n=>n[1].preload!==!1);for(const[n,a]of t)e.load.audio(n,a.path);this.loadChannelVolumes(e)}loadByChannel(e,t){this.soundLoader.loadByChannel(e,t),this.loadChannelVolumes(e)}loadBySoundKey(e,t){this.soundLoader.loadBySoundKey(e,t)}play(e){this.soundPlayer.play(e)}playOnce(e,t){e.sound.get(t)?.isPlaying||this.play(t)}lazyLoadPlay(e,t){const n=this.soundList[t]?.path;n&&(e.load.audio(t,n),e.load.once(`filecomplete-audio-${t}`,()=>{this.play(t)}))}setChannelVolume(e,t,n){(n<0||n>1)&&(n=Math.max(0,Math.min(1,n)),console.warn(`Volume must be between 0 and 1. Setting volume to ${n} instead in channel ${t}.`)),this.channelVolumes[t]=n,Object.entries(this.soundList).filter(a=>a[1].channel===t).forEach(([a])=>{const s=e.sound.get(a);s&&"setVolume"in s&&s.setVolume(n)}),this.saveChannelVolumes(e)}getChannelVolume(e){return this.channelVolumes[e]??1}muteChannel(e,t){this.setChannelVolume(e,t,0)}unmuteChannel(e,t){this.setChannelVolume(e,t,1)}getAllChannels(){return this.channels}persistNameKey(){return this.gameName?`phaser-sound-studio-volumes:${this.gameName}`:"phaser-sound-studio-volumes"}saveChannelVolumes(e){O(e,this.persistNameKey(),this.channelVolumes,void 0,this.storage).set(this.channelVolumes)}loadChannelVolumes(e){const t=O(e,this.persistNameKey(),this.channelVolumes,void 0,this.storage);this.channelVolumes=t.get()}}const te=(o,e=S)=>o.plugins.get(e),_={MOUSE_HOVER:"mouse-hover",MOUSE_CLICK:"mouse-click"},T={HUD:"hud"},oe={[_.MOUSE_HOVER]:{channel:T.HUD,preload:!0,path:"/sounds/ui-pop.m4a",loop:!1},[_.MOUSE_CLICK]:{channel:T.HUD,preload:!0,path:"/sounds/click.mp3",loop:!1}};class ne extends D{constructor(){super("sound-studio-demo")}preload(){te(this).loadAll(this)}create(){this.cameras.main.setBackgroundColor(this.pw.color.rgb("slate-900")),this.add.text(400,100,"Phaser Sound Studio Demo",{color:"#ffffff",align:"center",fontSize:"32px"}).setOrigin(.5,.5),this.add.text(400,150,"Click the button to play a sound effect",{color:"#bdc3c7",align:"center",fontSize:"18px"}).setOrigin(.5,.5);const e=new C({scene:this,x:400,y:250,backgroundColor:"blue-500",textColor:"white",text:"Play Click Sound",onClick:()=>{console.log("Playing click sound...")}}),t=new C({scene:this,x:400,y:320,backgroundColor:"green-500",textColor:"white",text:"Play Hover Sound",onClick:()=>{console.log("Playing hover sound...")}});this.add.existing(e),this.add.existing(t),this.add.text(400,450,"Sound Channels: HUD, SFX, MUSIC, VOICE",{color:"#95a5a6",align:"center",fontSize:"14px"}).setOrigin(.5,.5),this.add.text(400,500,"Note: This is a demo - actual sound files would be loaded",{color:"#e74c3c",align:"center",fontSize:"12px"}).setOrigin(.5,.5)}}document.addEventListener("DOMContentLoaded",()=>{const o=window.gameContainer;if(o){const e=new Phaser.Game({...o,plugins:{global:[{key:E,plugin:R,mapping:E,start:!0,data:{theme:N}},{key:S,plugin:ee,mapping:S,start:!0,data:{soundList:oe,channels:["hud"]}}]},scene:[ne]});window.__phaserGames||(window.__phaserGames={}),window.__phaserGames["phaser-sound-studio-main-demo"]=e}});
