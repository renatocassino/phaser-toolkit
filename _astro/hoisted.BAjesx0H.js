import{p}from"./PhaserGame.astro_astro_type_script_index_0_lang._ApvJukS.js";import{C as h,F as c}from"./scene-with-phaser-wind.CawGq48Q.js";import"./hoisted.B7maJBHf.js";const m={alpha:.5,strokeColor:1920728,strokeAlpha:.3,strokeWidth:5,radius:16,fillColor:2450411},g={alpha:.05,strokeColor:1920728,strokeAlpha:.3,strokeWidth:5,radius:64,fillColor:2450411},k={alpha:1,strokeColor:1920728,strokeAlpha:.4,strokeWidth:5,radius:40,fillColor:1920728},n={MOVE_FACTOR:.03,SCREEN_PADDING:24,MAX_DISTANCE_FACTOR:.9,DISTANCE_THRESHOLD_MULTIPLIER:2.1,DEFAULT_TOP_PADDING:.2,DEFAULT_LEFT_HALF:.5,HIDDEN_POSITION:-100,HIDDEN_ALPHA:0,VISIBLE_ALPHA:1},P=a=>{const t=a.scale.width,i=a.scale.height;return{topLeft:{x:0,y:i*n.DEFAULT_TOP_PADDING},bottomRight:{x:t*n.DEFAULT_LEFT_HALF,y:i}}},x=(a,t,i)=>a>=i.topLeft.x&&a<=i.bottomRight.x&&t>=i.topLeft.y&&t<=i.bottomRight.y,d=(a,t)=>`${a}${t}`.replace(/[^a-zA-Z0-9]/g,""),f=36,y=()=>{const a=performance.now().toString(f),t=Math.random().toString(f).substring(2);return`${a}${t}`.replace(/[^a-zA-Z0-9]/g,"")};class C extends p.GameObjects.Container{deadZone;baseArea;stick;stickIcon;analogContainer;startPosition;buttonsContainer;touchId=null;deadZoneConfig;baseAreaConfig;stickConfig;bounds;id;constructor({scene:t,deadZone:i,baseArea:s,stick:e,stickIcon:o,bounds:r,enableWithoutTouch:l=!1,id:u}){super(t,0,0),this.deadZoneConfig={...m,...i??{}},this.baseAreaConfig={...g,...s??{}},this.stickConfig={...k,...e??{}},this.id=u??y(),this.bounds=r??P(t),!(!this.scene.sys.game.device.input.touch&&!l)&&(this.setScrollFactor(0),this.createJoystick(o),this.setupEventListeners())}createJoystick(t){this.analogContainer=this.scene.add.container(n.HIDDEN_POSITION,n.HIDDEN_POSITION),this.add(this.analogContainer);const{deadZoneConfig:i,baseAreaConfig:s,stickConfig:e}=this;this.deadZone=this.scene.add.circle(0,0,i.radius,i.fillColor,i.alpha),this.deadZone.setOrigin(.5,.5).setStrokeStyle(i.strokeWidth,i.strokeColor,i.strokeAlpha),this.analogContainer.add(this.deadZone),this.baseArea=this.scene.add.circle(0,0,s.radius,s.fillColor,s.alpha),this.baseArea.setOrigin(.5,.5).setStrokeStyle(s.strokeWidth,s.strokeColor,s.strokeAlpha),this.analogContainer.add(this.baseArea),this.stick=this.scene.add.circle(0,0,e.radius,e.fillColor,e.alpha),this.stick.setOrigin(.5,.5).setStrokeStyle(e.strokeWidth,e.strokeColor,e.strokeAlpha),this.analogContainer.add(this.stick),t&&(this.stickIcon=t,this.analogContainer.add(this.stickIcon)),this.stickIcon&&(this.stickIcon.setOrigin(.5,.5),this.analogContainer.add(this.stickIcon))}resetJoystick(t){this.touchId===null||this.touchId!==t.id||this.startPosition===null||(this.analogContainer.setPosition(n.HIDDEN_POSITION,n.HIDDEN_POSITION),this.analogContainer.setAlpha(n.HIDDEN_ALPHA),this.stick.setPosition(0,0),this.stickIcon?.setPosition(0,0),this.startPosition=null,this.touchId=null)}on(t,i){if(t==="move"){const s=d("touchpad-joystick-update",this.id);return this.scene.events.on(s,i),this}if(t==="release"){const s=d("touchpad-joystick-release",this.id);return this.scene.events.on(s,i),this}if(t==="press"){const s=d("touchpad-joystick-press",this.id);return this.scene.events.on(s,i),this}return console.warn(`Event ${t} not supported`),this}emitMove(t,i){const s=d("touchpad-joystick-update",this.id);this.scene.events.emit(s,{x:t,y:i})}emitRelease(){const t=d("touchpad-joystick-release",this.id);this.scene.events.emit(t)}emitPress(){const t=d("touchpad-joystick-press",this.id);this.scene.events.emit(t)}update(){if(this.startPosition===null||!this.touchId||this.touchId!==this.scene.input.activePointer.id)return;let t=null;this.scene.input.manager.pointers&&(t=this.scene.input.manager.pointers.find(o=>o.id===this.touchId)),t??=this.scene.input.activePointer;const i=new p.Math.Vector2(t.x,t.y).subtract(this.startPosition),s=this.baseArea.radius*n.MAX_DISTANCE_FACTOR;i.length()>s*n.DISTANCE_THRESHOLD_MULTIPLIER&&this.moveJoystickToPointer(i)}moveJoystickToPointer(t){const i=n.SCREEN_PADDING;if(this.startPosition===null)return;let s=this.startPosition.x+t.x*n.MOVE_FACTOR,e=this.startPosition.y+t.y*n.MOVE_FACTOR;const o=this.bounds.topLeft.x+i+this.baseArea.radius+this.stick.radius,r=this.bounds.bottomRight.x-i-this.baseArea.radius-this.stick.radius,l=this.bounds.topLeft.y+i+this.baseArea.radius+this.stick.radius,u=this.bounds.bottomRight.y-i-this.baseArea.radius-this.stick.radius;s=Math.max(s,o),s=Math.min(s,r),e=Math.max(e,l),e=Math.min(e,u),this.startPosition.set(s,e),this.analogContainer.setPosition(s,e)}setupEventListeners(){this.scene.input.on("pointerdown",this.onPointerDown,this),this.scene.input.on("pointermove",this.onPointerMove,this),this.scene.input.on("pointerup",this.onPointerUp,this),this.scene.input.on("pointercancel",this.onPointerCancel,this)}onPointerDown(t){const{x:i,y:s}=t;this.touchId!==null||this.scene.input.hitTestPointer(t).some(r=>!r.input?.enabled||r===this||r===this.analogContainer?!1:r.parentContainer===this.buttonsContainer)||x(i,s,this.bounds)&&(this.analogContainer.setPosition(i,s),this.analogContainer.setAlpha(n.VISIBLE_ALPHA),this.stickIcon?.setPosition(0,0),this.startPosition=new p.Math.Vector2(i,s),this.touchId=t.id,this.emitPress())}onPointerMove(t){const{x:i,y:s}=t;if(this.startPosition===null||this.touchId==null||this.touchId!==t.id)return;const e=new p.Math.Vector2(i,s).subtract(this.startPosition),o=this.baseArea.radius*n.MAX_DISTANCE_FACTOR,r=e.length();r>o&&e.normalize().scale(o);const l=e.x/o,u=e.y/o;this.emitMove(l,u),this.stick.setPosition(e.x,e.y),this.stickIcon?.setPosition(e.x,e.y),r>o*n.DISTANCE_THRESHOLD_MULTIPLIER&&this.moveJoystickToPointer(e)}onPointerUp(t){this.touchId===t.id&&this.emitRelease(),this.resetJoystick(t)}onPointerCancel(t){this.touchId===t.id&&this.emitRelease(),this.resetJoystick(t)}destroy(){this.scene.input.off("pointerdown",this.onPointerDown,this),this.scene.input.off("pointermove",this.onPointerMove,this),this.scene.input.off("pointerup",this.onPointerUp,this),this.scene.input.off("pointercancel",this.onPointerCancel,this),this.removeAll(!0),this.startPosition=null,this.touchId=null,super.destroy()}}class A extends Phaser.Scene{joystick;positionText;eventText;character;axesPosition={x:0,y:0};constructor(){super({key:"virtual-joystick-demo"})}create(){this.cameras.main.setBackgroundColor(h.rgb("slate-900"));const t=this.cameras.main.centerX,i=this.cameras.main.centerY;this.add.text(t,80,"Phaser Virtual Joystick",{color:h.rgb("slate-200"),align:"center",fontSize:c.px("4xl")}).setOrigin(.5,.5),this.add.text(t,140,"Touch and drag in the left half of the screen to use the joystick",{color:h.rgb("slate-300"),align:"center",fontSize:c.px("lg"),wordWrap:{width:600}}).setOrigin(.5,.5),this.positionText=this.add.text(t,i-100,"Position: (0, 0)",{color:h.rgb("slate-200"),align:"center",fontSize:c.px("2xl")}).setOrigin(.5,.5),this.eventText=this.add.text(t,i-50,"Status: Ready",{color:h.rgb("slate-300"),align:"center",fontSize:c.px("lg")}).setOrigin(.5,.5);const s=this.add.circle(t+200,i,20,5195493,1);this.character=s,s.setStrokeStyle(2,3223169),this.joystick=new C({scene:this,bounds:{topLeft:{x:0,y:40},bottomRight:{x:this.cameras.main.width/2,y:this.cameras.main.height}},stickIcon:this.add.text(0,0,"ðŸŽ®",{fontSize:"24px",color:"#ffffff"}),enableWithoutTouch:!0}),this.add.existing(this.joystick),this.joystick.on("move",o=>{this.axesPosition={x:o.x,y:o.y},this.positionText&&this.positionText.setText(`Position: (${o.x.toFixed(2)}, ${o.y.toFixed(2)})`)}),this.joystick.on("press",()=>{this.axesPosition={x:0,y:0},this.eventText&&(this.eventText.setText("Status: Joystick Pressed"),this.eventText.setColor(h.rgb("green-400")))}),this.joystick.on("release",()=>{this.axesPosition={x:0,y:0},this.eventText&&(this.eventText.setText("Status: Joystick Released"),this.eventText.setColor(h.rgb("red-400")))}),this.add.rectangle(this.cameras.main.width/4,this.cameras.main.height/2,this.cameras.main.width/2,this.cameras.main.height,1976635,.1).setStrokeStyle(2,4674921,.3),this.add.text(this.cameras.main.width/4,50,"Joystick Area",{color:h.rgb("slate-400"),align:"center",fontSize:c.px("sm")}).setOrigin(.5,.5),this.add.text(t+200,50,"Character (moves with joystick)",{color:h.rgb("slate-400"),align:"center",fontSize:c.px("sm")}).setOrigin(.5,.5)}update(){this.joystick?.update();const t=1.1;(this.axesPosition.x!==0||this.axesPosition.y!==0)&&this.character?.setPosition(this.character.x+this.axesPosition.x*t,this.character.y+this.axesPosition.y*t)}destroy(){this.joystick&&this.joystick.destroy()}}document.addEventListener("DOMContentLoaded",()=>{const a=window.gameContainer;if(a){const t=new Phaser.Game({...a,scene:[A]});window.__phaserGames||(window.__phaserGames={}),window.__phaserGames["phaser-virtual-joystick-default-demo"]=t}});
