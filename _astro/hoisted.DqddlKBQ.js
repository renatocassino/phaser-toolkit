import{p as T}from"./PhaserGame.astro_astro_type_script_index_0_lang._ApvJukS.js";import{a as S,H as $,T as E}from"./plugin.BvEP2jIA.js";import{d as b}from"./scene-with-phaser-wind.CCvtJV7P.js";import{S as V}from"./scene-with-hudini.BxHrxqEo.js";import"./webfontloader.QfD90YS_.js";const D=10;class N{constructor(e){this.plugin=e,this.plugin=e}get game(){return this.plugin.getGame()}loadBySoundKey(e,t){const{game:n,plugin:s}=this;n.cache.audio.has(t)||e.load.audio(t,s.soundList[t]?.path)}loadByChannel(e,t){const{plugin:n}=this;Object.entries(n.soundList).filter(s=>s[1].channel===t).forEach(([s])=>{this.loadBySoundKey(e,s)})}}class _{constructor(e){this.plugin=e,this.plugin=e}get game(){return this.plugin.getGame()}get soundRegistry(){return this.plugin.soundRegistry}play(e){const t=this.soundRegistry.getChannelBySoundKey(e);switch(t.mode){case"single":this.playSingleMode(e);break;case"multiple":this.playMultipleMode(e,t.maxInstances);break}}playSingleMode(e){const t=this.soundRegistry.getSoundBySoundKey(e);if(t){t.isPlaying||t.play();return}const n=this.soundRegistry.getSoundConfigBySoundKey(e);this.game.sound.add(e,{volume:n?.channel?this.plugin.getChannelVolume(n.channel):1,loop:n?.loop??!1}).play()}playMultipleMode(e,t=D){const n=this.soundRegistry.fetchSoundsBySoundKey(e),s=n.find(a=>!a.isPlaying);if(s){s.play();return}if(n.length<t){const a=this.soundRegistry.getSoundConfigBySoundKey(e);this.game.sound.add(e,{volume:a?.channel?this.plugin.getChannelVolume(a.channel):1,loop:a?.loop??!1}).play()}}}class R{constructor(e){this.plugin=e,this.plugin=e}get game(){return this.plugin.getGame()}get soundPlayer(){return this.plugin.soundPlayer}get channels(){return this.plugin.channels}get soundList(){return this.plugin.soundList}getSoundConfigBySoundKey(e){return this.soundList[e]??null}getSoundBySoundKey(e){const t=this.fetchSoundsBySoundKey(e);return t.length>0?t[0]:null}fetchSoundsBySoundKey(e){return this.game.sound.getAll(e)}getChannelBySoundKey(e){const t=this.soundList[e];return this.channels[t.channel]}}function g(o){return o!==null&&typeof o=="object"&&!Array.isArray(o)&&Object.prototype.toString.call(o)==="[object Object]"}function L(o,...e){if(!g(o))return o;const t={...o};for(const n of e)if(g(n)){for(const s in n)if(Object.prototype.hasOwnProperty.call(n,s)){const a=n[s],r=t[s];g(a)&&g(r)?t[s]=L(r,a):a!==void 0&&(t[s]=a)}}return t}const u=()=>new Date().toISOString().replace("T"," ").replace("Z",""),h=o=>{const e=u(),t="%c[phaser-hooks]%c",n=o?` %c${o}%c`:"";return`%c[${e}]%c ${t}${n}`},d=o=>{const e=["color: #bd93f9; font-weight: bold;","color: inherit;","color: #2563eb; font-weight: bold;","color: inherit;"];return o&&e.push("color: #059669; font-weight: bold;","color: inherit;"),e},v=(o,e)=>{const t=h("STATE_INIT"),n=d("STATE_INIT");console.groupCollapsed(`${t} Initializing state "${o}"`,...n),console.log("🔧 Key:",o),console.log("📦 Initial Value:",e),console.log("⏰ Timestamp:",u()),console.groupEnd()},x=(o,e)=>{const t=h("STATE_GET"),n=d("STATE_GET");console.log(`${t} Getting state "${o}":`,...n,e)},f=(o,e,t)=>{const n=h("STATE_SET"),s=d("STATE_SET");console.groupCollapsed(`${n} Updating state "${o}"`,...s),console.log("🔑 Key:",o),console.log("📤 Old Value:",e),console.log("📥 New Value:",t),console.log("🔄 Changed:",e!==t),console.log("⏰ Timestamp:",u()),console.groupEnd()},O=(o,e,t)=>{const n=h("EVENT_ADD"),s=d("EVENT_ADD");console.groupCollapsed(`${n} Adding listener for "${o}"`,...s),console.log("🔑 Key:",o),console.log("📡 Event:",e),console.log("🎯 Callback:",t.name||"anonymous"),console.log("⏰ Timestamp:",u()),console.groupEnd()},m=(o,e,t)=>{const n=h("EVENT_REMOVE"),s=d("EVENT_REMOVE");console.groupCollapsed(`${n} Removing listener for "${o}"`,...s),console.log("🔑 Key:",o),console.log("📡 Event:",e),console.log("🎯 Callback:",t.name||"anonymous"),console.log("⏰ Timestamp:",u()),console.groupEnd()},A=o=>{const e=h("CLEAR_LISTENERS"),t=d("CLEAR_LISTENERS");console.groupCollapsed(`${e} Clearing all listeners for "${o}"`,...t),console.log("🔑 Key:",o),console.log("🧹 Action:","Removing all event listeners"),console.log("⏰ Timestamp:",u()),console.groupEnd()},K=(o,e,t)=>{const n=h(o),s=d(o);console.groupCollapsed(`${n} ERROR`,...s),console.error("🚨 Operation:",o),console.error("💥 Error:",e),t&&console.error("📋 Context:",t),console.error("⏰ Timestamp:",u()),console.groupEnd()},I=(o,e,t)=>{const n=h(o),s=d(o);console.groupCollapsed(`${n} WARNING`,...s),console.warn("⚠️ Operation:",o),console.warn("📢 Message:",e),t&&console.warn("📋 Context:",t),console.warn("⏰ Timestamp:",u()),console.groupEnd()},P=(o,e,t)=>{const n=o.get(e);return t&&x(e,n),n},B=(o,e,t,n,s)=>{const a=o.get(e),r=typeof t=="function"?t(a):t;if(s){const l=s(r);if(l!==!0){const i=typeof l=="string"?l:`Invalid value for key "${e}"`;throw new Error(`[withStateDef] ${i}`)}}o.set(e,r),n&&f(e,a,r)},M=(o,e,t,n,s)=>{const a=o.get(e);if(typeof a!="object"||a===null)throw new Error("[withStateDef] Current value is not an object");const r=typeof t=="function"?t(a):t,l=L({},a,r);if(s){const i=s(l);if(i!==!0){const c=typeof i=="string"?i:`Invalid value for key "${e}"`;throw new Error(`[withStateDef] ${c}`)}}o.set(e,l),n&&f(e,a,l)},G=(o,e,t,n)=>{if(I("DEPRECATED_ONCHANGE","onChange callback is deprecated in phaser-hooks. Use .on('change', callback) or .once('change', callback) instead.",{key:e}),!n||typeof n!="function")throw new Error("[withStateDef] onChange callback must be a function");o.events.on(`changedata-${e}`,(s,a,r,l)=>{t&&f(a,l,r);try{n(r,l)}catch(i){K("ONCHANGE_CALLBACK_ERROR",i,{key:a})}})},H=(o,e,t,n,s)=>{if(e!=="change")throw new Error('[withStateDef] Invalid event. Only "change" is supported.');return n&&O(t,e,s),o.events.on(`changedata-${t}`,s),()=>{n&&m(t,e,s),o.events.off(`changedata-${t}`,s)}},U=(o,e,t)=>{if(!o)throw new Error("[withStateDef] Scene parameter is required");if(!t||typeof t!="string"||t.trim().length===0)throw new Error("[withStateDef] Key must be a non-empty string");if(e.global&&!o.registry)throw new Error("[withStateDef] Scene registry is not available. Ensure the scene is properly initialized.");if(!e.global&&!o.data)throw new Error("[withStateDef] Scene data is not available. Ensure the scene is properly initialized.")},j=(o,e,t,n,s)=>{if(!o.has(e)&&s!==void 0){if(n){const a=n(s);if(a!==!0){const r=typeof a=="string"?a:`Invalid initial value for key "${e}"`;throw new Error(`[withStateDef] ${r}`)}}o.set(e,s),t&&v(e,s)}},z=(o,e,t,n,s)=>{if(e!=="change")throw new Error('[withStateDef] Invalid event. Only "change" is supported.');return n&&O(t,e,s),o.events.once(`changedata-${t}`,s),()=>{n&&m(t,e,s),o.events.off(`changedata-${t}`,s)}},F=(o,e,t,n,s)=>{if(e!=="change")throw new Error('[withStateDef] Invalid event. Only "change" is supported.');o.events.off(`changedata-${t}`,s),n&&m(t,e,s)},W=(o,e,t)=>{o.events.removeAllListeners(`changedata-${e}`),t&&A(e)},Y=(o,e,t,n={})=>{U(o,n,e);const{validator:s,debug:a=!1,global:r=!1}=n,l=r?o.registry:o.data;return j(l,e,a,s,t),{get:()=>P(l,e,a),set:i=>B(l,e,i,a,s),patch:i=>M(l,e,i,a,s),onChange:i=>G(l,e,a,i),on:(i,c)=>H(l,i,e,a,c),once:(i,c)=>z(l,i,e,a,c),off:(i,c)=>F(l,i,e,a,c),clearListeners:()=>W(l,e,a)}},q=(o,e,t,n)=>{if(!o)throw new Error("[withGlobalState] Scene parameter is required");const s=`phaser-hooks:global:${e}`;return Y(o,s,t,{...n,global:!0})},w=(o,e,t,n,s="local")=>{const a=`phaser-hooks-state:${e}`;let r=t;try{const i=s==="local"?localStorage.getItem(a):sessionStorage.getItem(a);i&&(r=JSON.parse(i))}catch(i){console.warn(`[withPersistentState] Failed to load stored state for "${e}":`,i)}const l=q(o,e,r);return l.onChange(i=>{try{(s==="local"?localStorage:sessionStorage).setItem(a,JSON.stringify(i))}catch(c){console.warn(`[withPersistentState] Failed to save state for "${e}":`,c)}}),l},p="soundStudio";class J extends T.Plugins.BasePlugin{channelVolumes={};soundPlayer;soundLoader;soundRegistry;soundList;channels;storage;gameName;getGame(){return this.game}constructor(e){super(e),this.soundList={},this.soundLoader=new N(this),this.channels={},this.storage="local",this.soundPlayer=new _(this),this.soundRegistry=new R(this)}init({soundList:e,channels:t,storage:n,gameName:s}){this.soundList=e,this.channels=t,this.storage=n,this.gameName=s,Object.keys(t).forEach(a=>{this.channelVolumes[a]=1})}loadAll(e){const t=Object.entries(this.soundList).filter(n=>n[1].preload!==!1);for(const[n,s]of t)e.load.audio(n,s.path);this.loadChannelVolumes(e)}loadByChannel(e,t){this.soundLoader.loadByChannel(e,t),this.loadChannelVolumes(e)}loadBySoundKey(e,t){this.soundLoader.loadBySoundKey(e,t)}play(e){this.soundPlayer.play(e)}playOnce(e,t){e.sound.get(t)?.isPlaying||this.play(t)}lazyLoadPlay(e,t){const n=this.soundList[t]?.path;n&&(e.load.audio(t,n),e.load.once(`filecomplete-audio-${t}`,()=>{this.play(t)}))}setChannelVolume(e,t,n){(n<0||n>1)&&(n=Math.max(0,Math.min(1,n)),console.warn(`Volume must be between 0 and 1. Setting volume to ${n} instead in channel ${t}.`)),this.channelVolumes[t]=n,Object.entries(this.soundList).filter(s=>s[1].channel===t).forEach(([s])=>{const a=e.sound.get(s);a&&"setVolume"in a&&a.setVolume(n)}),this.saveChannelVolumes(e)}getChannelVolume(e){return this.channelVolumes[e]??1}muteChannel(e,t){this.setChannelVolume(e,t,0)}unmuteChannel(e,t){this.setChannelVolume(e,t,1)}getAllChannels(){return this.channels}persistNameKey(){return this.gameName?`phaser-sound-studio-volumes:${this.gameName}`:"phaser-sound-studio-volumes"}saveChannelVolumes(e){w(e,this.persistNameKey(),this.channelVolumes,void 0,this.storage).set(this.channelVolumes)}loadChannelVolumes(e){const t=w(e,this.persistNameKey(),this.channelVolumes,void 0,this.storage);this.channelVolumes=t.get()}}const X=(o,e=p)=>o.plugins.get(e),y={MOUSE_HOVER:"mouse-hover",MOUSE_CLICK:"mouse-click"},C={HUD:"hud"},Z={[y.MOUSE_HOVER]:{channel:C.HUD,preload:!0,path:"/sounds/ui-pop.m4a",loop:!1},[y.MOUSE_CLICK]:{channel:C.HUD,preload:!0,path:"/sounds/click.mp3",loop:!1}};class Q extends V{constructor(){super("sound-studio-demo")}preload(){X(this).loadAll(this)}create(){this.cameras.main.setBackgroundColor(this.pw.color.rgb("slate-900")),this.add.text(400,100,"Phaser Sound Studio Demo",{color:"#ffffff",align:"center",fontSize:"32px"}).setOrigin(.5,.5),this.add.text(400,150,"Click the button to play a sound effect",{color:"#bdc3c7",align:"center",fontSize:"18px"}).setOrigin(.5,.5);const e=new E({scene:this,x:400,y:250,backgroundColor:"blue-500",textColor:"white",text:"Play Click Sound",onClick:()=>{console.log("Playing click sound...")}}),t=new E({scene:this,x:400,y:320,backgroundColor:"green-500",textColor:"white",text:"Play Hover Sound",onClick:()=>{console.log("Playing hover sound...")}});this.add.existing(e),this.add.existing(t),this.add.text(400,450,"Sound Channels: HUD, SFX, MUSIC, VOICE",{color:"#95a5a6",align:"center",fontSize:"14px"}).setOrigin(.5,.5),this.add.text(400,500,"Note: This is a demo - actual sound files would be loaded",{color:"#e74c3c",align:"center",fontSize:"12px"}).setOrigin(.5,.5)}}document.addEventListener("DOMContentLoaded",()=>{const o=window.gameContainer;if(o){const e=new Phaser.Game({...o,plugins:{global:[{key:S,plugin:$,mapping:S,start:!0,data:{theme:b}},{key:p,plugin:J,mapping:p,start:!0,data:{soundList:Z,channels:["hud"]}}]},scene:[Q]});window.__phaserGames||(window.__phaserGames={}),window.__phaserGames["phaser-sound-studio-main-demo"]=e}});
