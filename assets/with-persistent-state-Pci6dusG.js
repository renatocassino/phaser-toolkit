const u=(r,t,o,l={})=>{if(!r)throw new Error("[withStateDef] Scene parameter is required");if(l.global&&!r.registry)throw new Error("[withStateDef] Scene registry is not available. Ensure the scene is properly initialized.");if(!l.global&&!r.data)throw new Error("[withStateDef] Scene data is not available. Ensure the scene is properly initialized.");if(!t||typeof t!="string"||t.trim().length===0)throw new Error("[withStateDef] Key must be a non-empty string");const{validator:a,debug:n=!1,global:f=!1}=l,s=f?r.registry:r.data;if(!s.has(t)&&o!==void 0){if(a){const e=a(o);if(e!==!0){const g=typeof e=="string"?e:`Invalid initial value for key "${t}"`;throw new Error(`[withStateDef] ${g}`)}}f?s.set(t,o):r.data.set(t,o),n&&console.debug(`[withStateDef] Initialized "${t}" with value:`,o)}return{get:()=>{const e=s.get(t);return n&&console.debug(`[withStateDef] Getting "${t}":`,e),e},set:e=>{if(a){const h=a(e);if(h!==!0){const c=typeof h=="string"?h:`Invalid value for key "${t}"`;throw new Error(`[withStateDef] ${c}`)}}const g=s.get(t);s.set(t,e),n&&console.debug(`[withStateDef] Setting "${t}":`,{oldValue:g,newValue:e})},onChange:e=>{if(!e||typeof e!="function")throw new Error("[withStateDef] onChange callback must be a function");(f?s.events:r.data.events).on(`changedata-${t}`,(g,h,c,d)=>{n&&console.debug(`[withStateDef] Change detected for "${h}":`,{previousValue:d,value:c});try{e(c,d)}catch(S){console.error(`[withStateDef] Error in onChange callback for "${h}":`,S)}})}}},b=(r,t,o,l)=>{if(!r)throw new Error("[withGlobalState] Scene parameter is required");const a=`phaser-hooks:global:${t}`;return u(r,a,o,{...l,global:!0})},D=(r,t,o,l,a="local")=>{const n=`phaser-hooks-state:${t}`;let f=o;try{const i=a==="local"?localStorage.getItem(n):sessionStorage.getItem(n);i&&(f=JSON.parse(i))}catch(i){console.warn(`[withPersistentState] Failed to load stored state for "${t}":`,i)}const s=b(r,t,f);return s.onChange(i=>{try{(a==="local"?localStorage:sessionStorage).setItem(n,JSON.stringify(i))}catch(w){console.warn(`[withPersistentState] Failed to save state for "${t}":`,w)}}),s};export{b as a,D as b,u as w};
