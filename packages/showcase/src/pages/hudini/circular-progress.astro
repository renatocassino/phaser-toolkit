---
import Layout from '../../layouts/Layout.astro';
import PhaserGame from '../../components/PhaserGame.astro';
---
<Layout title="Hudini Circular Progress Component" description="Animated circular progress indicator using Font Awesome icons with customizable colors, sizes, and rotation speed.">
  <div class="space-y-8">
    <!-- Description -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
      <h2 class="text-xl font-semibold text-gray-900 mb-4">Circular Progress Component</h2>
      <p class="text-gray-600 mb-4">
        An animated circular progress indicator that uses Font Awesome icons and PhaserWind color tokens. Perfect for loading states, progress indicators, and visual feedback.
      </p>
      
      <!-- Features -->
      <div class="mb-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-3">Features</h3>
        <ul class="list-disc list-inside space-y-1 text-gray-600">
          <li>üîÑ <strong>Animated</strong>: Smooth rotation animation with configurable speed</li>
          <li>üé® <strong>Customizable</strong>: Choose from any Font Awesome icon and PhaserWind color</li>
          <li>‚öôÔ∏è <strong>Controllable</strong>: Start, stop, and adjust rotation speed dynamically</li>
          <li>üìè <strong>Flexible Sizing</strong>: Use PhaserWind font size tokens or pixel values</li>
        </ul>
      </div>

      <!-- Props -->
      <div class="mb-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-3">Props</h3>
        <div class="bg-gray-50 rounded-lg p-4">
          <ul class="space-y-2 text-sm">
            <li><code class="bg-gray-200 px-2 py-1 rounded">icon</code> - Font Awesome icon key (default: 'spinner')</li>
            <li><code class="bg-gray-200 px-2 py-1 rounded">size</code> - Font size token or pixel value (default: 'md')</li>
            <li><code class="bg-gray-200 px-2 py-1 rounded">color</code> - PhaserWind color token (default: 'blue')</li>
            <li><code class="bg-gray-200 px-2 py-1 rounded">rotationsPerSecond</code> - Rotation speed (default: 2)</li>
          </ul>
        </div>
      </div>

      <!-- Methods -->
      <div class="mb-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-3">Methods</h3>
        <div class="bg-gray-50 rounded-lg p-4">
          <ul class="space-y-2 text-sm">
            <li><code class="bg-gray-200 px-2 py-1 rounded">start()</code> - Start the spinning animation</li>
            <li><code class="bg-gray-200 px-2 py-1 rounded">stop()</code> - Stop the spinning animation</li>
            <li><code class="bg-gray-200 px-2 py-1 rounded">setRotationsPerSecond(speed)</code> - Change rotation speed</li>
            <li><code class="bg-gray-200 px-2 py-1 rounded">setIcon(icon)</code> - Change the icon</li>
            <li><code class="bg-gray-200 px-2 py-1 rounded">setColor(color)</code> - Change the color</li>
            <li><code class="bg-gray-200 px-2 py-1 rounded">setSize(size)</code> - Change the size</li>
            <li><code class="bg-gray-200 px-2 py-1 rounded">spinning</code> - Boolean property to check if currently spinning</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Live Example -->
    <PhaserGame width={800} height={600} />

    <!-- Usage Example -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
      <h3 class="text-lg font-semibold text-gray-900 mb-3">Usage Example</h3>
      <div class="bg-gray-900 rounded-lg p-4 overflow-x-auto">
        <pre class="text-sm text-gray-100"><code>{`import Phaser from 'phaser';
import {
    Color,
    createTheme,
    HUDINI_KEY,
    HudiniPlugin,
    SceneWithHudini,
    CircularProgress
} from 'hudini';

const theme = createTheme({});
type Theme = typeof theme;

class ProgressDemoScene extends SceneWithHudini<Theme> {
    constructor() {
        super('progress-demo');
    }

    create(): void {
        const { pw } = this.hudini;
        this.cameras.main.setBackgroundColor(pw.color.slate(900));

        // Default circular progress
        const defaultProgress = new CircularProgress({
            scene: this,
            x: this.cameras.main.centerX,
            y: this.cameras.main.centerY - 100,
        });
        this.add.existing(defaultProgress);

        // Custom colored progress
        const coloredProgress = new CircularProgress({
            scene: this,
            x: this.cameras.main.centerX,
            y: this.cameras.main.centerY,
            color: 'green',
            size: 'lg',
        });
        this.add.existing(coloredProgress);

        // Custom icon and speed
        const customProgress = new CircularProgress({
            scene: this,
            x: this.cameras.main.centerX,
            y: this.cameras.main.centerY + 100,
            icon: 'gear',
            color: 'purple',
            rotationsPerSecond: 1,
        });
        this.add.existing(customProgress);
    }
}`}</code></pre>
      </div>
    </div>
  </div>
</Layout>

<script>
  import Phaser from 'phaser';
  import {
    createTheme,
    HUDINI_KEY,
    HudiniPlugin,
    SceneWithHudini,
    CircularProgress
  } from 'hudini';
  import { loadFont } from 'font-awesome-for-phaser';

  // Create theme
  const theme = createTheme({});
  type Theme = typeof theme;

  class CircularProgressDemoScene extends SceneWithHudini<Theme> {
    private progresses: CircularProgress[] = [];
    private controls: Phaser.GameObjects.Text[] = [];

    constructor() {
      super('circular-progress-demo');
    }

    create(): void {
      const { pw } = this.hudini;
      this.cameras.main.setBackgroundColor(pw.color.slate(900));

      // Title
      this.add.text(this.cameras.main.centerX, 50, 'Circular Progress Examples', {
        color: pw.color.slate(200),
        align: 'center',
        fontSize: '32px',
        fontStyle: 'bold',
      }).setOrigin(0.5, 0.5);

      // Default progress (blue spinner)
      const defaultProgress = new CircularProgress({
        scene: this,
        x: this.cameras.main.centerX - 200,
        y: 150,
        size: 48,
        icon: 'spinner',
      });
      this.add.existing(defaultProgress);
      this.progresses.push(defaultProgress);

      this.add.text(this.cameras.main.centerX - 200, 200, 'Default\n(spinner, blue)', {
        color: pw.color.slate(300),
        align: 'center',
        fontSize: '14px',
      }).setOrigin(0.5, 0.5);

      // Green progress
      const greenProgress = new CircularProgress({
        scene: this,
        x: this.cameras.main.centerX,
        y: 150,
        color: 'green-500',
        size: 'lg',
      });
      this.add.existing(greenProgress);
      this.progresses.push(greenProgress);
      this.add.text(this.cameras.main.centerX, 200, 'Green\n(large)', {
        color: pw.color.slate(300),
        align: 'center',
        fontSize: '14px',
      }).setOrigin(0.5, 0.5);

      // Red gear progress
      const redProgress = new CircularProgress({
        scene: this,
        x: this.cameras.main.centerX + 200,
        y: 150,
        icon: 'gear',
        color: 'red-500',
        size: 'xl',
      });
      this.add.existing(redProgress);
      this.progresses.push(redProgress);
      this.add.text(this.cameras.main.centerX + 200, 200, 'Red Gear\n(extra large)', {
        color: pw.color.slate(300),
        align: 'center',
        fontSize: '14px',
      }).setOrigin(0.5, 0.5);

      // Purple rotate icon (slow)
      const slowProgress = new CircularProgress({
        scene: this,
        x: this.cameras.main.centerX - 200,
        y: 300,
        icon: 'rotate',
        color: 'purple-500',
        size: 'lg',
        rotationsPerSecond: 0.5,
      });
      this.add.existing(slowProgress);
      this.progresses.push(slowProgress);
      this.add.text(this.cameras.main.centerX - 200, 350, 'Purple Rotate\n(0.5 rps)', {
        color: pw.color.slate(300),
        align: 'center',
        fontSize: '14px',
      }).setOrigin(0.5, 0.5);

      // Yellow arrows-rotate (fast)
      const fastProgress = new CircularProgress({
        scene: this,
        x: this.cameras.main.centerX,
        y: 300,
        icon: 'arrows-rotate',
        color: 'yellow-500',
        size: 'lg',
        rotationsPerSecond: 4,
      });
      this.add.existing(fastProgress);
      this.progresses.push(fastProgress);
      this.add.text(this.cameras.main.centerX, 350, 'Yellow Arrows\n(4 rps)', {
        color: pw.color.slate(300),
        align: 'center',
        fontSize: '14px',
      }).setOrigin(0.5, 0.5);

      // Cyan spinner (pixel size)
      const pixelProgress = new CircularProgress({
        scene: this,
        x: this.cameras.main.centerX + 200,
        y: 300,
        icon: 'spinner',
        color: 'cyan',
        size: 48,
      });
      this.add.existing(pixelProgress);
      this.progresses.push(pixelProgress);
      this.add.text(this.cameras.main.centerX + 200, 350, 'Cyan Spinner\n(48px)', {
        color: pw.color.slate(300),
        align: 'center',
        fontSize: '14px',
      }).setOrigin(0.5, 0.5);

      // Controllable progress
      const controllableProgress = new CircularProgress({
        scene: this,
        x: this.cameras.main.centerX,
        y: 450,
        icon: 'gear',
        color: 'pink-500',
        size: 'lg',
      });
      this.add.existing(controllableProgress);
      this.progresses.push(controllableProgress);

      // Control buttons
      const startButton = this.add.text(
        this.cameras.main.centerX - 100,
        520,
        'Start',
        {
          color: pw.color.rgb('green-400'),
          backgroundColor: pw.color.rgb('green-900'),
          padding: { x: 12, y: 6 },
          fontSize: '16px',
        }
      ).setOrigin(0.5, 0.5)
        .setInteractive({ useHandCursor: true })
        .on('pointerdown', () => {
          controllableProgress.start();
          this.updateControlText();
        })
        .on('pointerover', () => startButton.setAlpha(0.8))
        .on('pointerout', () => startButton.setAlpha(1));

      const stopButton = this.add.text(
        this.cameras.main.centerX + 100,
        520,
        'Stop',
        {
          color: pw.color.rgb('red-400'),
          backgroundColor: pw.color.rgb('red-900'),
          padding: { x: 12, y: 6 },
          fontSize: '16px',
        }
      ).setOrigin(0.5, 0.5)
        .setInteractive({ useHandCursor: true })
        .on('pointerdown', () => {
          controllableProgress.stop();
          this.updateControlText();
        })
        .on('pointerover', () => stopButton.setAlpha(0.8))
        .on('pointerout', () => stopButton.setAlpha(1));

      // Status text
      const statusText = this.add.text(
        this.cameras.main.centerX,
        480,
        'Status: Spinning',
        {
          color: pw.color.slate(300),
          align: 'center',
          fontSize: '14px',
        }
      ).setOrigin(0.5, 0.5);

      this.controls.push(statusText);

      // Update status periodically
      this.time.addEvent({
        delay: 100,
        callback: () => {
          this.updateControlText();
        },
        loop: true,
      });

      // Instructions
      this.add.text(
        this.cameras.main.centerX,
        560,
        'Click Start/Stop to control the pink gear spinner',
        {
          color: pw.color.slate(400),
          align: 'center',
          fontSize: '14px',
        }
      ).setOrigin(0.5, 0.5);
    }

    private updateControlText(): void {
      const controllableProgress = this.progresses[6]; // The controllable one
      if (controllableProgress && this.controls.length > 0) {
        const statusText = this.controls[0];
        statusText.setText(`Status: ${controllableProgress.spinning ? 'Spinning' : 'Stopped'}`);
      }
    }
  }

  // Initialize the game when the page loads
  document.addEventListener('DOMContentLoaded', () => {
    const gameConfig = (window as any).gameContainer;
    if (gameConfig) {
      const game = new Phaser.Game({
        ...gameConfig,
        scene: [CircularProgressDemoScene],
        plugins: {
          global: [
            {
              key: HUDINI_KEY,
              plugin: HudiniPlugin,
              mapping: HUDINI_KEY,
              data: {
                theme,
              },
            },
          ],
        },
      });
      
      // Store the game instance
      if (!(window as any).__phaserGames) {
        (window as any).__phaserGames = {};
      }
      (window as any).__phaserGames['hudini-circular-progress-demo'] = game;
    }
  });
</script>
