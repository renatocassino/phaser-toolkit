---
import Layout from '../../layouts/Layout.astro';
import PhaserGame from '../../components/PhaserGame.astro';
---
<Layout title="Hudini Linear Progress Component" description="Horizontal progress bar with customizable colors, sizes, and support for both determinate and indeterminate modes.">
  <div class="space-y-8">
    <!-- Description -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
      <h2 class="text-xl font-semibold text-gray-900 mb-4">Linear Progress Component</h2>
      <p class="text-gray-600 mb-4">
        A horizontal progress bar component with smooth animations, customizable colors, and support for both determinate (showing specific progress) and indeterminate (loading animation) modes.
      </p>
      
      <!-- Features -->
      <div class="mb-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-3">Features</h3>
        <ul class="list-disc list-inside space-y-1 text-gray-600">
          <li>üìä <strong>Determinate Mode</strong>: Show specific progress values (0-100%) with smooth animations</li>
          <li>‚ôæÔ∏è <strong>Indeterminate Mode</strong>: Animated loading bar for unknown progress duration</li>
          <li>üé® <strong>Customizable</strong>: Full control over colors, sizes, and border radius</li>
          <li>‚ö° <strong>Animated</strong>: Smooth transitions when updating progress values</li>
          <li>üìè <strong>Flexible Sizing</strong>: Set custom width and height in pixels</li>
        </ul>
      </div>

      <!-- Props -->
      <div class="mb-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-3">Props</h3>
        <div class="bg-gray-50 rounded-lg p-4">
          <ul class="space-y-2 text-sm">
            <li><code class="bg-gray-200 px-2 py-1 rounded">width</code> - Width of the progress bar in pixels (required)</li>
            <li><code class="bg-gray-200 px-2 py-1 rounded">height</code> - Height of the progress bar in pixels (required)</li>
            <li><code class="bg-gray-200 px-2 py-1 rounded">backgroundColor</code> - Background color token (default: 'gray-200')</li>
            <li><code class="bg-gray-200 px-2 py-1 rounded">progressColor</code> - Progress fill color token (default: 'blue-500')</li>
            <li><code class="bg-gray-200 px-2 py-1 rounded">borderRadius</code> - Border radius token or pixel value (default: 'default')</li>
            <li><code class="bg-gray-200 px-2 py-1 rounded">progress</code> - Initial progress value 0-100 (default: 0)</li>
            <li><code class="bg-gray-200 px-2 py-1 rounded">indeterminate</code> - Whether to show indeterminate animation (default: false)</li>
            <li><code class="bg-gray-200 px-2 py-1 rounded">indeterminateAnimationDuration</code> - Animation duration in ms (default: 1500)</li>
          </ul>
        </div>
      </div>

      <!-- Methods -->
      <div class="mb-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-3">Methods</h3>
        <div class="bg-gray-50 rounded-lg p-4">
          <ul class="space-y-2 text-sm">
            <li><code class="bg-gray-200 px-2 py-1 rounded">setProgress(progress, animate?)</code> - Set progress value (0-100), animate defaults to true</li>
            <li><code class="bg-gray-200 px-2 py-1 rounded">getProgress()</code> - Get current progress value (0-100)</li>
            <li><code class="bg-gray-200 px-2 py-1 rounded">setIndeterminate(indeterminate)</code> - Toggle indeterminate mode</li>
            <li><code class="bg-gray-200 px-2 py-1 rounded">setBorderRadius(radius)</code> - Change border radius</li>
            <li><code class="bg-gray-200 px-2 py-1 rounded">setBackgroundColor(color)</code> - Change background color</li>
            <li><code class="bg-gray-200 px-2 py-1 rounded">setProgressColor(color)</code> - Change progress fill color</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Live Example -->
    <PhaserGame width={800} height={600} />

    <!-- Usage Example -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
      <h3 class="text-lg font-semibold text-gray-900 mb-3">Usage Example</h3>
      <div class="bg-gray-900 rounded-lg p-4 overflow-x-auto">
        <pre class="text-sm text-gray-100"><code>{`import Phaser from 'phaser';
import {
    Color,
    createTheme,
    HUDINI_KEY,
    HudiniPlugin,
    SceneWithHudini,
    LinearProgress
} from 'hudini';

const theme = createTheme({});
type Theme = typeof theme;

class ProgressDemoScene extends SceneWithHudini<Theme> {
    private progressBar?: LinearProgress;

    constructor() {
        super('progress-demo');
    }

    create(): void {
        const { pw } = this.hudini;
        this.cameras.main.setBackgroundColor(pw.color.slate(900));

        // Create a progress bar
        this.progressBar = new LinearProgress({
            scene: this,
            x: this.cameras.main.centerX,
            y: this.cameras.main.centerY,
            width: 400,
            height: 20,
            backgroundColor: 'gray-200',
            progressColor: 'blue-500',
            borderRadius: 'md',
            progress: 0,
        });
        this.add.existing(this.progressBar);

        // Animate progress over time
        this.time.addEvent({
            delay: 100,
            callback: () => {
                const current = this.progressBar!.getProgress();
                if (current < 100) {
                    this.progressBar!.setProgress(current + 1);
                }
            },
            repeat: 100,
        });
    }
}`}</code></pre>
      </div>
    </div>
  </div>
</Layout>

<script>
  import Phaser from 'phaser';
  import {
    Color,
    createTheme,
    HUDINI_KEY,
    HudiniPlugin,
    SceneWithHudini,
    LinearProgress
  } from 'hudini';

  // Create theme
  const theme = createTheme({});
  type Theme = typeof theme;

  class LinearProgressDemoScene extends SceneWithHudini<Theme> {
    private progressBars: LinearProgress[] = [];
    private indeterminateBar?: LinearProgress;
    private controllableBar?: LinearProgress;
    private progressValue: number = 0;
    private autoProgressTimer?: Phaser.Time.TimerEvent;
    private isControllableIndeterminate: boolean = false;

    constructor() {
      super('linear-progress-demo');
    }

    create(): void {
      const { pw } = this.hudini;
      this.cameras.main.setBackgroundColor(pw.color.slate(900));

      // Title
      this.add.text(this.cameras.main.centerX, 40, 'Linear Progress Examples', {
        color: pw.color.slate(200),
        align: 'center',
        fontSize: '32px',
        fontStyle: 'bold',
      }).setOrigin(0.5, 0.5);

      // Default progress bar (blue)
      const defaultBar = new LinearProgress({
        scene: this,
        x: this.cameras.main.centerX,
        y: 100,
        width: 500,
        height: 24,
        backgroundColor: 'gray-200',
        progressColor: 'blue-500',
        borderRadius: 'md',
        progress: 0,
      });
      this.add.existing(defaultBar);
      this.progressBars.push(defaultBar);
      this.add.text(this.cameras.main.centerX, 130, 'Default (Blue)', {
        color: pw.color.slate(300),
        align: 'center',
        fontSize: '14px',
      }).setOrigin(0.5, 0.5);

      // Green progress bar
      const greenBar = new LinearProgress({
        scene: this,
        x: this.cameras.main.centerX,
        y: 180,
        width: 500,
        height: 24,
        backgroundColor: 'gray-200',
        progressColor: 'green-500',
        borderRadius: 'md',
        progress: 0,
      });
      this.add.existing(greenBar);
      this.progressBars.push(greenBar);
      this.add.text(this.cameras.main.centerX, 210, 'Green', {
        color: pw.color.slate(300),
        align: 'center',
        fontSize: '14px',
      }).setOrigin(0.5, 0.5);

      // Red progress bar (rounded)
      const redBar = new LinearProgress({
        scene: this,
        x: this.cameras.main.centerX,
        y: 260,
        width: 500,
        height: 24,
        backgroundColor: 'gray-200',
        progressColor: 'red-500',
        borderRadius: 'lg',
        progress: 0,
      });
      this.add.existing(redBar);
      this.progressBars.push(redBar);
      this.add.text(this.cameras.main.centerX, 290, 'Red (Rounded)', {
        color: pw.color.slate(300),
        align: 'center',
        fontSize: '14px',
      }).setOrigin(0.5, 0.5);

      // Purple progress bar (thin)
      const purpleBar = new LinearProgress({
        scene: this,
        x: this.cameras.main.centerX,
        y: 320,
        width: 500,
        height: 12,
        backgroundColor: 'gray-200',
        progressColor: 'purple-500',
        borderRadius: 'full',
        progress: 0,
      });
      this.add.existing(purpleBar);
      this.progressBars.push(purpleBar);
      this.add.text(this.cameras.main.centerX, 340, 'Purple (Thin)', {
        color: pw.color.slate(300),
        align: 'center',
        fontSize: '14px',
      }).setOrigin(0.5, 0.5);

      // Yellow progress bar (thick)
      const yellowBar = new LinearProgress({
        scene: this,
        x: this.cameras.main.centerX,
        y: 380,
        width: 500,
        height: 40,
        backgroundColor: 'gray-200',
        progressColor: 'yellow-500',
        borderRadius: 'md',
        progress: 0,
      });
      this.add.existing(yellowBar);
      this.progressBars.push(yellowBar);
      this.add.text(this.cameras.main.centerX, 410, 'Yellow (Thick)', {
        color: pw.color.slate(300),
        align: 'center',
        fontSize: '14px',
      }).setOrigin(0.5, 0.5);

      // Indeterminate progress bar
      this.indeterminateBar = new LinearProgress({
        scene: this,
        x: this.cameras.main.centerX,
        y: 460,
        width: 500,
        height: 24,
        backgroundColor: 'gray-200',
        progressColor: 'cyan-500',
        borderRadius: 'md',
        indeterminate: true,
      });
      this.add.existing(this.indeterminateBar);
      this.add.text(this.cameras.main.centerX, 490, 'Indeterminate (Cyan)', {
        color: pw.color.slate(300),
        align: 'center',
        fontSize: '14px',
      }).setOrigin(0.5, 0.5);

      // Controllable progress bar
      this.controllableBar = new LinearProgress({
        scene: this,
        x: this.cameras.main.centerX,
        y: 540,
        width: 500,
        height: 24,
        backgroundColor: 'gray-200',
        progressColor: 'pink-500',
        borderRadius: 'md',
        progress: 0,
      });
      this.add.existing(this.controllableBar);

      // Control buttons
      const resetButton = this.add.text(
        this.cameras.main.centerX - 150,
        580,
        'Reset',
        {
          color: pw.color.rgb('yellow-400'),
          backgroundColor: pw.color.rgb('yellow-900'),
          padding: { x: 12, y: 6 },
          fontSize: '16px',
        }
      ).setOrigin(0.5, 0.5)
        .setInteractive({ useHandCursor: true })
        .on('pointerdown', () => {
          this.progressValue = 0;
          this.controllableBar!.setProgress(0, false);
          this.updateProgressText();
        })
        .on('pointerover', () => resetButton.setAlpha(0.8))
        .on('pointerout', () => resetButton.setAlpha(1));

      const addButton = this.add.text(
        this.cameras.main.centerX - 50,
        580,
        '+10%',
        {
          color: pw.color.rgb('green-400'),
          backgroundColor: pw.color.rgb('green-900'),
          padding: { x: 12, y: 6 },
          fontSize: '16px',
        }
      ).setOrigin(0.5, 0.5)
        .setInteractive({ useHandCursor: true })
        .on('pointerdown', () => {
          this.progressValue = Math.min(100, this.progressValue + 10);
          this.controllableBar!.setProgress(this.progressValue);
          this.updateProgressText();
        })
        .on('pointerover', () => addButton.setAlpha(0.8))
        .on('pointerout', () => addButton.setAlpha(1));

      const subtractButton = this.add.text(
        this.cameras.main.centerX + 50,
        580,
        '-10%',
        {
          color: pw.color.rgb('red-400'),
          backgroundColor: pw.color.rgb('red-900'),
          padding: { x: 12, y: 6 },
          fontSize: '16px',
        }
      ).setOrigin(0.5, 0.5)
        .setInteractive({ useHandCursor: true })
        .on('pointerdown', () => {
          if (!this.isControllableIndeterminate) {
            this.progressValue = Math.max(0, this.progressValue - 10);
            this.controllableBar!.setProgress(this.progressValue);
            this.updateProgressText();
          }
        })
        .on('pointerover', () => subtractButton.setAlpha(0.8))
        .on('pointerout', () => subtractButton.setAlpha(1));

      const toggleIndeterminateButton = this.add.text(
        this.cameras.main.centerX + 150,
        580,
        'Toggle Indeterminate',
        {
          color: pw.color.rgb('purple-400'),
          backgroundColor: pw.color.rgb('purple-900'),
          padding: { x: 12, y: 6 },
          fontSize: '14px',
        }
      ).setOrigin(0.5, 0.5)
        .setInteractive({ useHandCursor: true })
        .on('pointerdown', () => {
          this.isControllableIndeterminate = !this.isControllableIndeterminate;
          this.controllableBar!.setIndeterminate(this.isControllableIndeterminate);
          if (!this.isControllableIndeterminate) {
            this.controllableBar!.setProgress(this.progressValue);
          }
          this.updateProgressText();
        })
        .on('pointerover', () => toggleIndeterminateButton.setAlpha(0.8))
        .on('pointerout', () => toggleIndeterminateButton.setAlpha(1));

      // Progress text
      const progressText = this.add.text(
        this.cameras.main.centerX,
        560,
        'Progress: 0%',
        {
          color: pw.color.slate(300),
          align: 'center',
          fontSize: '14px',
        }
      ).setOrigin(0.5, 0.5);

      // Store reference for updates
      (this as any).progressText = progressText;

      // Auto-progress animation for demo bars
      this.autoProgressTimer = this.time.addEvent({
        delay: 50,
        callback: () => {
          this.progressBars.forEach((bar, index) => {
            const current = bar.getProgress();
            if (current < 100) {
              const increment = (index + 1) * 0.5; // Different speeds for each bar
              bar.setProgress(Math.min(100, current + increment), true);
            } else {
              // Reset when complete
              bar.setProgress(0, false);
            }
          });
        },
        loop: true,
      });

      // Update progress text periodically
      this.time.addEvent({
        delay: 100,
        callback: () => {
          this.updateProgressText();
        },
        loop: true,
      });
    }

    private updateProgressText(): void {
      if (this.controllableBar && (this as any).progressText) {
        const text = (this as any).progressText as Phaser.GameObjects.Text;
        if (this.isControllableIndeterminate) {
          text.setText('Progress: Indeterminate');
        } else {
          const progress = this.controllableBar.getProgress();
          text.setText(`Progress: ${Math.round(progress)}%`);
        }
      }
    }
  }

  // Initialize the game when the page loads
  document.addEventListener('DOMContentLoaded', () => {
    const gameConfig = (window as any).gameContainer;
    if (gameConfig) {
      const game = new Phaser.Game({
        ...gameConfig,
        scene: [LinearProgressDemoScene],
        plugins: {
          global: [
            {
              key: HUDINI_KEY,
              plugin: HudiniPlugin,
              mapping: HUDINI_KEY,
              data: {
                theme,
              },
            },
          ],
        },
      });
      
      // Store the game instance
      if (!(window as any).__phaserGames) {
        (window as any).__phaserGames = {};
      }
      (window as any).__phaserGames['hudini-linear-progress-demo'] = game;
    }
  });
</script>
