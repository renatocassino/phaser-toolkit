---
import Layout from '../../layouts/Layout.astro';
import PhaserGame from '../../components/PhaserGame.astro';
---
<Layout title="Hudini Radial Progress Component" description="Circular progress bar (arc/gauge) with customizable colors, thickness, and optional percentage text display.">
  <div class="space-y-8">
    <!-- Description -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
      <h2 class="text-xl font-semibold text-gray-900 mb-4">Radial Progress Component</h2>
      <p class="text-gray-600 mb-4">
        A circular progress bar component that displays progress as a radial arc (gauge). Perfect for showing progress in a circular format with customizable colors, thickness, and optional percentage text in the center.
      </p>
      
      <!-- Features -->
      <div class="mb-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-3">Features</h3>
        <ul class="list-disc list-inside space-y-1 text-gray-600">
          <li>üìä <strong>Circular Arc</strong>: Progress displayed as a radial arc/gauge</li>
          <li>üé® <strong>Customizable</strong>: Full control over colors, thickness, radius, and start angle</li>
          <li>üìù <strong>Optional Text</strong>: Show percentage text in the center with customizable styling</li>
          <li>‚ö° <strong>Animated</strong>: Smooth transitions when updating progress values</li>
          <li>üéØ <strong>Flexible</strong>: Configurable start angle and background alpha</li>
        </ul>
      </div>

      <!-- Props -->
      <div class="mb-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-3">Props</h3>
        <div class="bg-gray-50 rounded-lg p-4">
          <ul class="space-y-2 text-sm">
            <li><code class="bg-gray-200 px-2 py-1 rounded">radius</code> - Radius of the progress bar in pixels (required)</li>
            <li><code class="bg-gray-200 px-2 py-1 rounded">thickness</code> - Thickness of the arc in pixels (default: 4)</li>
            <li><code class="bg-gray-200 px-2 py-1 rounded">backgroundColor</code> - Background circle color token (default: 'gray-200')</li>
            <li><code class="bg-gray-200 px-2 py-1 rounded">backgroundAlpha</code> - Background alpha 0-1 (default: 0.2)</li>
            <li><code class="bg-gray-200 px-2 py-1 rounded">progressColor</code> - Progress arc color token (default: 'blue-500')</li>
            <li><code class="bg-gray-200 px-2 py-1 rounded">progress</code> - Initial progress value 0-100 (default: 0)</li>
            <li><code class="bg-gray-200 px-2 py-1 rounded">startAngle</code> - Start angle in degrees (default: 270, top)</li>
            <li><code class="bg-gray-200 px-2 py-1 rounded">showText</code> - Show percentage text in center (default: false)</li>
            <li><code class="bg-gray-200 px-2 py-1 rounded">textColor</code> - Text color token (default: 'white')</li>
            <li><code class="bg-gray-200 px-2 py-1 rounded">fontSize</code> - Font size token (default: 'base')</li>
            <li><code class="bg-gray-200 px-2 py-1 rounded">textAlpha</code> - Text alpha 0-1 (default: 1)</li>
          </ul>
        </div>
      </div>

      <!-- Methods -->
      <div class="mb-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-3">Methods</h3>
        <div class="bg-gray-50 rounded-lg p-4">
          <ul class="space-y-2 text-sm">
            <li><code class="bg-gray-200 px-2 py-1 rounded">setProgress(progress, animate?)</code> - Set progress value (0-100), animate defaults to true</li>
            <li><code class="bg-gray-200 px-2 py-1 rounded">getProgress()</code> - Get current progress value (0-100)</li>
            <li><code class="bg-gray-200 px-2 py-1 rounded">setBackgroundColor(color)</code> - Change background color</li>
            <li><code class="bg-gray-200 px-2 py-1 rounded">setBackgroundAlpha(alpha)</code> - Change background alpha</li>
            <li><code class="bg-gray-200 px-2 py-1 rounded">setProgressColor(color)</code> - Change progress arc color</li>
            <li><code class="bg-gray-200 px-2 py-1 rounded">setShowText(show)</code> - Toggle percentage text display</li>
            <li><code class="bg-gray-200 px-2 py-1 rounded">setTextColor(color)</code> - Change text color</li>
            <li><code class="bg-gray-200 px-2 py-1 rounded">setFontSize(size)</code> - Change font size</li>
            <li><code class="bg-gray-200 px-2 py-1 rounded">setTextAlpha(alpha)</code> - Change text alpha</li>
            <li><code class="bg-gray-200 px-2 py-1 rounded">setRadius(radius)</code> - Change radius</li>
            <li><code class="bg-gray-200 px-2 py-1 rounded">setThickness(thickness)</code> - Change arc thickness</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Live Example -->
    <PhaserGame width={800} height={600} />

    <!-- Usage Example -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
      <h3 class="text-lg font-semibold text-gray-900 mb-3">Usage Example</h3>
      <div class="bg-gray-900 rounded-lg p-4 overflow-x-auto">
        <pre class="text-sm text-gray-100"><code>{`import Phaser from 'phaser';
import {
    Color,
    createTheme,
    HUDINI_KEY,
    HudiniPlugin,
    SceneWithHudini,
    RadialProgress
} from 'hudini';

const theme = createTheme({});
type Theme = typeof theme;

class ProgressDemoScene extends SceneWithHudini<Theme> {
    private progressBar?: RadialProgress;

    constructor() {
        super('progress-demo');
    }

    create(): void {
        const { pw } = this.hudini;
        this.cameras.main.setBackgroundColor(pw.color.slate(900));

        // Create a radial progress bar with text
        this.progressBar = new RadialProgress({
            scene: this,
            x: this.cameras.main.centerX,
            y: this.cameras.main.centerY,
            radius: 80,
            thickness: 8,
            backgroundColor: 'gray-200',
            backgroundAlpha: 0.2,
            progressColor: 'blue-500',
            progress: 0,
            showText: true,
            textColor: 'white',
            fontSize: 'lg',
        });
        this.add.existing(this.progressBar);

        // Animate progress over time
        this.time.addEvent({
            delay: 100,
            callback: () => {
                const current = this.progressBar!.getProgress();
                if (current < 100) {
                    this.progressBar!.setProgress(current + 1);
                }
            },
            repeat: 100,
        });
    }
}`}</code></pre>
      </div>
    </div>
  </div>
</Layout>

<script>
  import Phaser from 'phaser';
  import {
    Color,
    createTheme,
    HUDINI_KEY,
    HudiniPlugin,
    SceneWithHudini,
    RadialProgress
  } from 'hudini';

  // Create theme
  const theme = createTheme({});
  type Theme = typeof theme;

  class RadialProgressDemoScene extends SceneWithHudini<Theme> {
    private progressBars: RadialProgress[] = [];
    private controllableBar?: RadialProgress;
    private progressValue: number = 0;

    constructor() {
      super('radial-progress-demo');
    }

    create(): void {
      const { pw } = this.hudini;
      this.cameras.main.setBackgroundColor(pw.color.slate(900));

      // Title
      this.add.text(this.cameras.main.centerX, 40, 'Radial Progress Examples', {
        color: pw.color.slate(200),
        align: 'center',
        fontSize: '32px',
        fontStyle: 'bold',
      }).setOrigin(0.5, 0.5);

      // Default progress bar (blue, no text)
      const defaultBar = new RadialProgress({
        scene: this,
        x: this.cameras.main.centerX - 200,
        y: 150,
        radius: 60,
        thickness: 6,
        backgroundColor: 'gray-200',
        backgroundAlpha: 0.2,
        progressColor: 'blue-500',
        progress: 0,
        showText: false,
      });
      this.add.existing(defaultBar);
      this.progressBars.push(defaultBar);
      this.add.text(this.cameras.main.centerX - 200, 230, 'Default\n(no text)', {
        color: pw.color.slate(300),
        align: 'center',
        fontSize: '14px',
      }).setOrigin(0.5, 0.5);

      // Green progress bar with text
      const greenBar = new RadialProgress({
        scene: this,
        x: this.cameras.main.centerX,
        y: 150,
        radius: 60,
        thickness: 8,
        backgroundColor: 'gray-200',
        backgroundAlpha: 0.2,
        progressColor: 'green-500',
        progress: 0,
        showText: true,
        textColor: 'white',
        fontSize: 'lg',
      });
      this.add.existing(greenBar);
      this.progressBars.push(greenBar);
      this.add.text(this.cameras.main.centerX, 230, 'Green\n(with text)', {
        color: pw.color.slate(300),
        align: 'center',
        fontSize: '14px',
      }).setOrigin(0.5, 0.5);

      // Red progress bar (thick)
      const redBar = new RadialProgress({
        scene: this,
        x: this.cameras.main.centerX + 200,
        y: 150,
        radius: 60,
        thickness: 12,
        backgroundColor: 'gray-200',
        backgroundAlpha: 0.3,
        progressColor: 'red-500',
        progress: 0,
        showText: true,
        textColor: 'white',
        fontSize: 'base',
      });
      this.add.existing(redBar);
      this.progressBars.push(redBar);
      this.add.text(this.cameras.main.centerX + 200, 230, 'Red\n(thick)', {
        color: pw.color.slate(300),
        align: 'center',
        fontSize: '14px',
      }).setOrigin(0.5, 0.5);

      // Purple progress bar (large)
      const purpleBar = new RadialProgress({
        scene: this,
        x: this.cameras.main.centerX - 200,
        y: 320,
        radius: 80,
        thickness: 8,
        backgroundColor: 'gray-200',
        backgroundAlpha: 0.2,
        progressColor: 'purple-500',
        progress: 0,
        showText: true,
        textColor: 'white',
        fontSize: 'xl',
      });
      this.add.existing(purpleBar);
      this.progressBars.push(purpleBar);
      this.add.text(this.cameras.main.centerX - 200, 420, 'Purple\n(large)', {
        color: pw.color.slate(300),
        align: 'center',
        fontSize: '14px',
      }).setOrigin(0.5, 0.5);

      // Yellow progress bar (thin)
      const yellowBar = new RadialProgress({
        scene: this,
        x: this.cameras.main.centerX,
        y: 320,
        radius: 70,
        thickness: 3,
        backgroundColor: 'gray-200',
        backgroundAlpha: 0.2,
        progressColor: 'yellow-500',
        progress: 0,
        showText: true,
        textColor: 'black',
        fontSize: 'base',
      });
      this.add.existing(yellowBar);
      this.progressBars.push(yellowBar);
      this.add.text(this.cameras.main.centerX, 410, 'Yellow\n(thin)', {
        color: pw.color.slate(300),
        align: 'center',
        fontSize: '14px',
      }).setOrigin(0.5, 0.5);

      // Cyan progress bar (small)
      const cyanBar = new RadialProgress({
        scene: this,
        x: this.cameras.main.centerX + 200,
        y: 320,
        radius: 50,
        thickness: 6,
        backgroundColor: 'gray-200',
        backgroundAlpha: 0.2,
        progressColor: 'cyan-500',
        progress: 0,
        showText: true,
        textColor: 'white',
        fontSize: 'sm',
      });
      this.add.existing(cyanBar);
      this.progressBars.push(cyanBar);
      this.add.text(this.cameras.main.centerX + 200, 390, 'Cyan\n(small)', {
        color: pw.color.slate(300),
        align: 'center',
        fontSize: '14px',
      }).setOrigin(0.5, 0.5);

      // Controllable progress bar
      this.controllableBar = new RadialProgress({
        scene: this,
        x: this.cameras.main.centerX,
        y: 480,
        radius: 70,
        thickness: 10,
        backgroundColor: 'gray-200',
        backgroundAlpha: 0.2,
        progressColor: 'pink-500',
        progress: 0,
        showText: true,
        textColor: 'white',
        fontSize: 'xl',
      });
      this.add.existing(this.controllableBar);

      // Control buttons
      const resetButton = this.add.text(
        this.cameras.main.centerX - 150,
        560,
        'Reset',
        {
          color: pw.color.rgb('yellow-400'),
          backgroundColor: pw.color.rgb('yellow-900'),
          padding: { x: 12, y: 6 },
          fontSize: '16px',
        }
      ).setOrigin(0.5, 0.5)
        .setInteractive({ useHandCursor: true })
        .on('pointerdown', () => {
          this.progressValue = 0;
          this.controllableBar!.setProgress(0, false);
          this.updateProgressText();
        })
        .on('pointerover', () => resetButton.setAlpha(0.8))
        .on('pointerout', () => resetButton.setAlpha(1));

      const addButton = this.add.text(
        this.cameras.main.centerX - 50,
        560,
        '+10%',
        {
          color: pw.color.rgb('green-400'),
          backgroundColor: pw.color.rgb('green-900'),
          padding: { x: 12, y: 6 },
          fontSize: '16px',
        }
      ).setOrigin(0.5, 0.5)
        .setInteractive({ useHandCursor: true })
        .on('pointerdown', () => {
          this.progressValue = Math.min(100, this.progressValue + 10);
          this.controllableBar!.setProgress(this.progressValue);
          this.updateProgressText();
        })
        .on('pointerover', () => addButton.setAlpha(0.8))
        .on('pointerout', () => addButton.setAlpha(1));

      const subtractButton = this.add.text(
        this.cameras.main.centerX + 50,
        560,
        '-10%',
        {
          color: pw.color.rgb('red-400'),
          backgroundColor: pw.color.rgb('red-900'),
          padding: { x: 12, y: 6 },
          fontSize: '16px',
        }
      ).setOrigin(0.5, 0.5)
        .setInteractive({ useHandCursor: true })
        .on('pointerdown', () => {
          this.progressValue = Math.max(0, this.progressValue - 10);
          this.controllableBar!.setProgress(this.progressValue);
          this.updateProgressText();
        })
        .on('pointerover', () => subtractButton.setAlpha(0.8))
        .on('pointerout', () => subtractButton.setAlpha(1));

      const toggleTextButton = this.add.text(
        this.cameras.main.centerX + 150,
        560,
        'Toggle Text',
        {
          color: pw.color.rgb('purple-400'),
          backgroundColor: pw.color.rgb('purple-900'),
          padding: { x: 12, y: 6 },
          fontSize: '14px',
        }
      ).setOrigin(0.5, 0.5)
        .setInteractive({ useHandCursor: true })
        .on('pointerdown', () => {
          this.showText = !this.showText;
          this.controllableBar!.setShowText(this.showText);
        })
        .on('pointerover', () => toggleTextButton.setAlpha(0.8))
        .on('pointerout', () => toggleTextButton.setAlpha(1));

      // Progress text
      const progressText = this.add.text(
        this.cameras.main.centerX,
        540,
        'Progress: 0%',
        {
          color: pw.color.slate(300),
          align: 'center',
          fontSize: '14px',
        }
      ).setOrigin(0.5, 0.5);

      // Store reference for updates
      (this as any).progressText = progressText;

      // Auto-progress animation for demo bars
      this.time.addEvent({
        delay: 50,
        callback: () => {
          this.progressBars.forEach((bar, index) => {
            const current = bar.getProgress();
            if (current < 100) {
              const increment = (index + 1) * 0.5; // Different speeds for each bar
              bar.setProgress(Math.min(100, current + increment), true);
            } else {
              // Reset when complete
              bar.setProgress(0, false);
            }
          });
        },
        loop: true,
      });

      // Update progress text periodically
      this.time.addEvent({
        delay: 100,
        callback: () => {
          this.updateProgressText();
        },
        loop: true,
      });
    }

    private updateProgressText(): void {
      if (this.controllableBar && (this as any).progressText) {
        const progress = this.controllableBar.getProgress();
        const text = (this as any).progressText as Phaser.GameObjects.Text;
        text.setText(`Progress: ${Math.round(progress)}%`);
      }
    }
  }

  // Initialize the game when the page loads
  document.addEventListener('DOMContentLoaded', () => {
    const gameConfig = (window as any).gameContainer;
    if (gameConfig) {
      const game = new Phaser.Game({
        ...gameConfig,
        scene: [RadialProgressDemoScene],
        plugins: {
          global: [
            {
              key: HUDINI_KEY,
              plugin: HudiniPlugin,
              mapping: HUDINI_KEY,
              data: {
                theme,
              },
            },
          ],
        },
      });
      
      // Store the game instance
      if (!(window as any).__phaserGames) {
        (window as any).__phaserGames = {};
      }
      (window as any).__phaserGames['hudini-radial-progress-demo'] = game;
    }
  });
</script>
