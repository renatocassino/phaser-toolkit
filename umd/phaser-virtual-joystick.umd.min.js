!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports,require("phaser")):"function"==typeof define&&define.amd?define(["exports","phaser"],i):i((t="undefined"!=typeof globalThis?globalThis:t||self).phaserVirtualJoystick={},t.Phaser)}(this,function(t,i){"use strict";function e(t){var i=Object.create(null);return t&&Object.keys(t).forEach(function(e){if("default"!==e){var o=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(i,e,o.get?o:{enumerable:!0,get:function(){return t[e]}})}}),i.default=t,Object.freeze(i)}var o=e(i),s=function(t,i){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)Object.prototype.hasOwnProperty.call(i,e)&&(t[e]=i[e])},s(t,i)};var n=function(){return n=Object.assign||function(t){for(var i,e=1,o=arguments.length;e<o;e++)for(var s in i=arguments[e])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t},n.apply(this,arguments)};"function"==typeof SuppressedError&&SuppressedError;var r,a={alpha:.5,strokeColor:1920728,strokeAlpha:.3,strokeWidth:5,radius:16,fillColor:2450411},h={alpha:.05,strokeColor:1920728,strokeAlpha:.3,strokeWidth:5,radius:64,fillColor:2450411},c={alpha:1,strokeColor:1920728,strokeAlpha:.4,strokeWidth:5,radius:40,fillColor:1920728},u={MOVE_FACTOR:.03,SCREEN_PADDING:24,MAX_DISTANCE_FACTOR:.9,DISTANCE_THRESHOLD_MULTIPLIER:2.1,DEFAULT_TOP_PADDING:.2,DEFAULT_LEFT_HALF:.5,HIDDEN_POSITION:-100,HIDDEN_ALPHA:0,VISIBLE_ALPHA:1},l=function(t){var i=t.scale.width,e=t.scale.height;return{topLeft:{x:0,y:e*u.DEFAULT_TOP_PADDING},bottomRight:{x:i*u.DEFAULT_LEFT_HALF,y:e}}},p=function(t,i,e){return t>=e.topLeft.x&&t<=e.bottomRight.x&&i>=e.topLeft.y&&i<=e.bottomRight.y};t.VirtualJoystickEvents=void 0,(r=t.VirtualJoystickEvents||(t.VirtualJoystickEvents={})).UPDATE="touchpad-joystick-update",r.RELEASE="touchpad-joystick-release",r.PRESS="touchpad-joystick-press";var d=function(i){function e(t){var e=t.scene,o=t.deadZone,s=t.baseArea,r=t.stick,u=t.stickIcon,p=t.bounds,d=t.enableWithoutTouch,f=void 0!==d&&d,y=i.call(this,e,0,0)||this;return y.touchId=null,y.deadZoneConfig=n(n({},a),null!=o?o:{}),y.baseAreaConfig=n(n({},h),null!=s?s:{}),y.stickConfig=n(n({},c),null!=r?r:{}),y.bounds=null!=p?p:l(e),y.scene.sys.game.device.input.touch||f?(y.setScrollFactor(0),y.createJoystick(u),y.setupEventListeners(),y):y}return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function e(){this.constructor=t}s(t,i),t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)}(e,i),e.prototype.createJoystick=function(t){this.analogContainer=this.scene.add.container(u.HIDDEN_POSITION,u.HIDDEN_POSITION),this.add(this.analogContainer);var i=this,e=i.deadZoneConfig,o=i.baseAreaConfig,s=i.stickConfig;this.deadZone=this.scene.add.circle(0,0,e.radius,e.fillColor,e.alpha),this.deadZone.setOrigin(.5,.5).setStrokeStyle(e.strokeWidth,e.strokeColor,e.strokeAlpha),this.analogContainer.add(this.deadZone),this.baseArea=this.scene.add.circle(0,0,o.radius,o.fillColor,o.alpha),this.baseArea.setOrigin(.5,.5).setStrokeStyle(o.strokeWidth,o.strokeColor,o.strokeAlpha),this.analogContainer.add(this.baseArea),this.stick=this.scene.add.circle(0,0,s.radius,s.fillColor,s.alpha),this.stick.setOrigin(.5,.5).setStrokeStyle(s.strokeWidth,s.strokeColor,s.strokeAlpha),this.analogContainer.add(this.stick),t&&(this.stickIcon=t,this.analogContainer.add(this.stickIcon)),this.stickIcon&&(this.stickIcon.setOrigin(.5,.5),this.analogContainer.add(this.stickIcon))},e.prototype.resetJoystick=function(t){var i;null!==this.touchId&&this.touchId===t.id&&null!==this.startPosition&&(this.analogContainer.setPosition(u.HIDDEN_POSITION,u.HIDDEN_POSITION),this.analogContainer.setAlpha(u.HIDDEN_ALPHA),this.stick.setPosition(0,0),null===(i=this.stickIcon)||void 0===i||i.setPosition(0,0),this.startPosition=null,this.touchId=null)},e.prototype.on=function(i,e){return"move"===i?(this.scene.events.on(t.VirtualJoystickEvents.UPDATE,e),this):"release"===i?(this.scene.events.on(t.VirtualJoystickEvents.RELEASE,e),this):"press"===i?(this.scene.events.on(t.VirtualJoystickEvents.PRESS,e),this):(console.warn("Event ".concat(i," not supported")),this)},e.prototype.emitMove=function(i,e){this.scene.events.emit(t.VirtualJoystickEvents.UPDATE,{x:i,y:e})},e.prototype.emitRelease=function(){this.scene.events.emit(t.VirtualJoystickEvents.RELEASE)},e.prototype.emitPress=function(){this.scene.events.emit(t.VirtualJoystickEvents.PRESS)},e.prototype.update=function(){var t=this;if(null!==this.startPosition&&this.touchId&&this.touchId===this.scene.input.activePointer.id){var i=null;this.scene.input.manager.pointers&&(i=this.scene.input.manager.pointers.find(function(i){return i.id===t.touchId})),null!=i||(i=this.scene.input.activePointer);var e=new o.Math.Vector2(i.x,i.y).subtract(this.startPosition),s=this.baseArea.radius*u.MAX_DISTANCE_FACTOR;e.length()>s*u.DISTANCE_THRESHOLD_MULTIPLIER&&this.moveJoystickToPointer(e)}},e.prototype.moveJoystickToPointer=function(t){var i=u.SCREEN_PADDING;if(null!==this.startPosition){var e=this.startPosition.x+t.x*u.MOVE_FACTOR,o=this.startPosition.y+t.y*u.MOVE_FACTOR,s=this.bounds.topLeft.x+i+this.baseArea.radius+this.stick.radius,n=this.bounds.bottomRight.x-i-this.baseArea.radius-this.stick.radius,r=this.bounds.topLeft.y+i+this.baseArea.radius+this.stick.radius,a=this.bounds.bottomRight.y-i-this.baseArea.radius-this.stick.radius;e=Math.max(e,s),e=Math.min(e,n),o=Math.max(o,r),o=Math.min(o,a),this.startPosition.set(e,o),this.analogContainer.setPosition(e,o)}},e.prototype.setupEventListeners=function(){this.scene.input.on("pointerdown",this.onPointerDown,this),this.scene.input.on("pointermove",this.onPointerMove,this),this.scene.input.on("pointerup",this.onPointerUp,this),this.scene.input.on("pointercancel",this.onPointerCancel,this)},e.prototype.onPointerDown=function(t){var i,e=this,s=t.x,n=t.y;if(null===this.touchId){var r=this.scene.input.hitTestPointer(t).some(function(t){var i;return!!(null===(i=t.input)||void 0===i?void 0:i.enabled)&&(t!==e&&t!==e.analogContainer&&t.parentContainer===e.buttonsContainer)});r||p(s,n,this.bounds)&&(this.analogContainer.setPosition(s,n),this.analogContainer.setAlpha(u.VISIBLE_ALPHA),null===(i=this.stickIcon)||void 0===i||i.setPosition(0,0),this.startPosition=new o.Math.Vector2(s,n),this.touchId=t.id,this.emitPress())}},e.prototype.onPointerMove=function(t){var i,e=t.x,s=t.y;if(null!==this.startPosition&&this.touchId&&this.touchId===t.id){var n=new o.Math.Vector2(e,s).subtract(this.startPosition),r=this.baseArea.radius*u.MAX_DISTANCE_FACTOR,a=n.length();a>r&&n.normalize().scale(r);var h=n.x/r,c=n.y/r;this.emitMove(h,c),this.stick.setPosition(n.x,n.y),null===(i=this.stickIcon)||void 0===i||i.setPosition(n.x,n.y),a>r*u.DISTANCE_THRESHOLD_MULTIPLIER&&this.moveJoystickToPointer(n)}},e.prototype.onPointerUp=function(t){this.emitRelease(),this.resetJoystick(t)},e.prototype.onPointerCancel=function(t){this.emitRelease(),this.resetJoystick(t)},e.prototype.destroy=function(){this.scene.input.off("pointerdown",this.onPointerDown,this),this.scene.input.off("pointermove",this.onPointerMove,this),this.scene.input.off("pointerup",this.onPointerUp,this),this.scene.input.off("pointercancel",this.onPointerCancel,this),this.removeAll(!0),this.startPosition=null,this.touchId=null,i.prototype.destroy.call(this)},e}(o.GameObjects.Container);t.JOYSTICK_CONSTANTS=u,t.VirtualJoystick=d,t.baseAreaConfigDefault=h,t.deadZoneConfigDefault=a,t.getDefaultBounds=l,t.isWithinBounds=p,t.stickConfigDefault=c});
